<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Number Announcer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f2f2f2;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: #fff;
            width: 90%;
            max-width: 350px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            text-align: center;
        }

        h2 {
            margin-bottom: 20px;
            font-size: 22px;
        }

        input {
            width: 100%;
            padding: 14px;
            font-size: 20px;
            text-align: center;
            border-radius: 8px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
        }

        button {
            width: 100%;
            padding: 14px;
            font-size: 20px;
            border-radius: 8px;
            border: none;
            background: #007bff;
            color: white;
            cursor: pointer;
        }

        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸ”Š Number Announcer</h2>
    <input type="number" id="numberInput" placeholder="Enter number">
    <button id="playBtn">Play</button>
</div>

<script>
const input = document.getElementById("numberInput");
const playBtn = document.getElementById("playBtn");

let voices = [];
let audioFallback = null;

/* ---------- LOAD VOICES ---------- */
function loadVoices() {
    voices = speechSynthesis.getVoices();
}
speechSynthesis.onvoiceschanged = loadVoices;

/* ---------- FALLBACK AUDIO ---------- */
// Example MP3 (replace with your own recorded files)
function playFallback(number) {
    if (audioFallback) {
        audioFallback.pause();
        audioFallback.currentTime = 0;
    }

    audioFallback = new Audio(`audio/${number}.mp3`);
    audioFallback.play().catch(err => {
        alert("Audio playback blocked. Please tap again.");
        console.error(err);
    });
}

/* ---------- INIT ---------- */
window.onload = () => {
    loadVoices();
    const saved = localStorage.getItem("lastNumber");
    if (saved) input.value = saved;
};

/* ---------- MAIN PLAY ---------- */
playBtn.addEventListener("click", () => {
    const number = input.value.trim();
    if (!number) {
        alert("Please enter a number");
        return;
    }

    localStorage.setItem("lastNumber", number);

    // Reload voices (important for Bluetooth)
    voices = speechSynthesis.getVoices();

    // Stop previous speech
    speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(number);
    utterance.lang = "en-US";
    utterance.rate = 0.85;
    utterance.pitch = 0.9;
    utterance.volume = 1.0;

    // Preferred voice
    const preferredVoice = voices.find(v =>
        v.lang === "en-US" &&
        (v.name.toLowerCase().includes("google") ||
         v.name.toLowerCase().includes("female") ||
         v.name.toLowerCase().includes("samantha"))
    );

    if (preferredVoice) {
        utterance.voice = preferredVoice;
    }

    let spoke = false;

    utterance.onstart = () => {
        spoke = true;
    };

    utterance.onerror = () => {
        console.warn("TTS failed, using fallback");
        playFallback(number);
    };

    // ðŸš¨ Bluetooth routing delay (CRITICAL)
    setTimeout(() => {
        speechSynthesis.speak(utterance);

        // If no sound detected â†’ fallback
        setTimeout(() => {
            if (!spoke) {
                console.warn("No sound detected, fallback audio");
                playFallback(number);
            }
        }, 1200);
    }, 300);
});
</script>

</body>
</html>
